---
title: 网络协议简述及实现
published: 2025-02-23
description: "学习记录"
image: ""
tags: ["C++", "TCP", "UDP","后端", "计算机网络"]
category: 编程
draft: true
---

## 网络协议

### 简述

网络协议是计算机网络中用于通信的规则和标准。它们定义了数据如何在网络中传输、如何格式化、如何寻址、如何路由、如何确保数据的完整性和安全性等。网络协议通常分为不同的层次，每一层负责不同的功能。

### 分类

按照网络分层模型分类一般可以分成OSI模型和TCP/IP模型，常用的是TCP/IP模型，由四层组成，分别是：
1. **网络接口层**（Network Interface Layer）
    * 协议：Ethernet、WiFi、PPP
    * 作用：负责将数据从网络层传输到物理介质；处理与硬件相关的细节，如数据帧的封装、物理地址（MAC 地址）的寻址等
2. **网络层**（Network Layer）
    * 协议：IP、ICMP、IGMP，ARP
    * 作用：负责将数据包从源主机传输到目标主机，跨越多个网络
3. **传输层**（Transport Layer）
    * 协议：TCP、UDP
    * 作用：提供端到端的通信服务，确保数据可靠传输或高效传输；管理数据的分段、流量控制、错误恢复和复用
4. **应用层**（Application Layer）
    * 协议：HTTP、FTP、SMTP、DNS、SSH、Telnet
    * 功能：为用户提供网络服务和应用程序接口；处理特定应用程序的通信细节，如数据格式、会话管理等

按照功能分类可以分成数据传输协议、路由协议、应用层协议、安全协议等。

1. **数据传输协议**
    * TCP（Transmission Control Protocol）
    * UDP（User Datagram Protocol）
2. **应用层协议**
    * HTTP/HTTPS
    * FTP（File Transfer Protocol）
    * DNS（Domain Name System）
    * SNMP（Simple Network Management Protocol）

## TCP

传输控制协议（TCP，TransmissionControl Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议，是为了在不可靠的互联网络上提供可靠的端到端字节流而专门设计的一个传输协议。

### 特点

1. **面向连接**：TCP 是一个面向连接的协议，它需要建立连接才能进行通信，并在连接结束后断开连接。通信双方在传输数据之前需要建立连接（三次握手），传输结束后需要释放连接（四次挥手）。
2. **可靠传输**：通过确认机制（ACK）、重传机制、校验和等方式确保数据可靠传输
3. **基于字节流**：TCP 将数据视为无结构的字节流，不保留消息边界
4. **全双工通信**：TCP 是一个全双工协议，即客户端和服务器可以同时进行数据传输。

### 报文结构
```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |       Destination Port        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Acknowledgment Number                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Data |           |U|A|P|R|S|F|                               |
| Offset| Reserved  |R|C|S|S|Y|I|            Window             |
|       |           |G|K|H|T|N|N|                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Checksum            |         Urgent Pointer        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options (if any)                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Data                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**字段说明**
1. Source Port（源端口）：发送方的端口号。
2. Destination Port（目标端口）：接收方的端口号。
3. Sequence Number（序列号）：当前报文段第一个字节的序列号。
4. Acknowledgment Number（确认号）：期望收到的下一个字节的序列号。
5. Data Offset（数据偏移）：TCP 头部的长度（以 4 字节为单位）。
6. Control Flags（控制标志）：
    * URG：紧急指针有效。
    * ACK：确认号有效。
    * PSH：接收方应尽快将数据交给应用层。
    * RST：重置连接。
    * SYN：同步序列号，用于建立连接。
    * FIN：发送方完成数据发送，用于关闭连接。
7. Window（窗口大小）：接收方的可用缓冲区大小，用于流量控制。
8. Checksum（校验和）：用于错误检测。
9.  Urgent Pointer（紧急指针）：指示紧急数据的末尾位置。
10. Options（选项）：可选字段，用于扩展功能（如最大报文段大小 MSS）。
11. Data（数据）：实际传输的数据。


## UDP
